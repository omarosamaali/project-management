@extends('layouts.app')

@section('title', 'فاتورة الدفع - طلب خاص')

@section('content')
<section class="p-3 sm:p-5">
    <div class="mx-auto max-w-4xl">
        <div class="mb-4 flex justify-between items-center no-print">
            <a href="{{ route('dashboard.special-request.show', $specialRequest->id) }}"
                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition flex items-center gap-2">
                <i class="fas fa-arrow-right"></i>
                رجوع إلى تفاصيل الطلب
            </a>
            <button onclick="window.print()"
                class="px-6 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition flex items-center gap-2">
                <i class="fas fa-print"></i>
                طباعة الفاتورة
            </button>
        </div>

        <div class="bg-white shadow-none rounded-xl overflow-hidden border-2 border-black print-container">

            <div class="grid lg:grid-cols-3 md:grid-cols-1 text-black p-8 border-b border-black">
                <div class="bg-white p-2 rounded-lg w-fit mx-auto lg:order-2">
                    <img src="{{ asset('assets/images/logo.webp') }}" alt="iFork Logo"
                        class="h-24 w-24 object-contain grayscale">
                </div>

                <div class="text-right lg:order-1">
                    <h1 class="text-xl text-black font-bold mb-1">ايفورك للتكنولوجيا</h1>
                    <p class="text-sm text-black">الامارات العربية المتحدة, إمارة دبي</p>
                    <p class="text-sm text-black">منطقة الورقاء2</p>
                    <p class="text-sm text-black">شركة مرخصة من دائرة الاقتصاد والسياحة بدبي</p>
                </div>

                <div class="text-left lg:order-3">
                    <h1 class="text-xl text-black font-bold mb-1">EVORQ TECHNOLOGIES</h1>
                    <p class="text-sm text-black">United Arab Emirates, Dubai</p>
                    <p class="text-sm text-black">Al Warqa 2</p>
                    <p class="text-sm text-black">A company licensed by the Dubai Department of Economy and Tourism</p>
                </div>
            </div>

            <div class="p-8 grid md:grid-cols-2 gap-8 border-b border-gray-300">
                <div>
                    <h3 class="text-lg font-bold text-black mb-3 flex items-center gap-2">
                        <i class="fas fa-user text-black"></i>
                        بيانات العميل / Customer Details
                    </h3>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-2">
                        <p class="font-bold text-black">{{ $specialRequest->user->name ?? '-' }}</p>
                        <p class="text-gray-700 text-sm">{{ $specialRequest->user->phone ?? '-' }}</p>
                        <p class="text-gray-700 text-sm">{{ $specialRequest->user->email ?? '-' }}</p>
                        <p class="text-gray-700 text-sm">
                            @php
                            $countries = [
                            'EG' => 'مصر', 'SA' => 'السعودية', 'AE' => 'الإمارات',
                            'KW' => 'الكويت', 'QA' => 'قطر', 'BH' => 'البحرين',
                            'OM' => 'عُمان', 'JO' => 'الأردن', 'LB' => 'لبنان',
                            'IQ' => 'العراق', 'SY' => 'سوريا', 'YE' => 'اليمن',
                            'LY' => 'ليبيا', 'TN' => 'تونس', 'DZ' => 'الجزائر',
                            'MA' => 'المغرب', 'SD' => 'السودان', 'PS' => 'فلسطين',
                            'US' => 'الولايات المتحدة', 'GB' => 'المملكة المتحدة',
                            'DE' => 'ألمانيا', 'FR' => 'فرنسا', 'IN' => 'الهند',
                            'PK' => 'باكستان', 'TR' => 'تركيا',
                            ];
                            @endphp
                            {{ $countries[$specialRequest->user->country] ?? $specialRequest->user->country ?? '-' }}
                        </p>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-bold text-black mb-3 flex items-center gap-2">
                        <i class="fas fa-receipt text-black"></i>
                        تفاصيل الدفع / Payment Details
                    </h3>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-2">
                        <p class="text-gray-700 text-sm"><strong>رقم الفاتورة:</strong> INV-{{ $payment->id }}-{{
                            $specialRequest->id }}</p>
                        <p class="text-gray-700 text-sm"><strong>تاريخ الدفع:</strong> {{ $payment->created_at ?
                            $payment->created_at->format('Y-m-d H:i') : now()->format('Y-m-d H:i') }}</p>
                        <p class="text-gray-700 text-sm"><strong>طريقة الدفع:</strong> (بوابة دفع إلكترونية)</p>
                        @if($installment)
                        <p class="text-gray-700 text-sm"><strong>نوع الدفع:</strong> {{
                            $installment->payment_name }}</p>
                        @else
                        {{-- <p class="text-gray-700 text-sm">
                            <strong>نوع الدفع:</strong> {{ $$installment->payment_name ?? 'غير محدد' }}
                        </p> --}}
                        @endif
                    </div>
                </div>
            </div>

            <div class="p-8">
                <h3 class="text-lg font-bold text-black mb-4 flex items-center gap-2">
                    <i class="fas fa-list-alt text-black"></i>
                    تفاصيل الدفع / Payment Details
                </h3>

                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-100 border-b-2 border-black">
                                <th class="text-right py-3 px-4 font-bold text-black">البيان</th>
                                <th class="text-center py-3 px-4 font-bold text-black">المبلغ</th>
                                <th class="py-3 px-4 font-bold text-black text-left">Statement</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            @php
                            if ($installment) {
                            $baseAmount = floatval($installment->amount);
                            } else {
                            $totalAmount = floatval($payment->amount);
                            $baseAmount = round(($totalAmount - 2) / 1.079, 2);
                            }
                            $calculatedFees = round(($baseAmount * 0.079) + 2, 2);
                            $totalWithFees = round($baseAmount + $calculatedFees, 2);
                            @endphp
                            <tr>
                                <td class="py-3 px-4 text-black">المبلغ الأساسي</td>
                                <td class="text-center py-3 px-4 text-black font-bold">
                                    <div class="flex items-center gap-1 justify-center">
                                        <span dir="ltr">{{ number_format($baseAmount, 2) }}</span>
                                        <span class="text-xs">
                                            <svg width="{{ $width ?? 14 }}" height="{{ $height ?? 14 }}"
                                                xmlns="http://www.w3.org/2000/svg" width="1000" height="870"
                                                viewBox="0 0 1000 870" fill="none">
                                                <path
                                                    d="M88.3 1C88.7 1.6 90.9 4.3 93 6.9C108.3 25.1 119.8 54.7 126 92C130.1 116.5 130.3 124.2 130.3 217.6V304.6H88.5C50.3 304.6 45.9 304.4 38.4 302.9C26.6 300.4 14.4 293.7 6.2 285.1C-0.3 278.2 -0.1 277.8 0.3 298.7C0.8 316 1 317.9 3.5 327.3C7.5 342.2 13 353.3 21.3 363.2C32.6 376.8 44.1 384.4 60.5 389.5C64 390.5 71.4 390.9 97.6 391.1L130.3 391.6V434.9V478.3L84.2 478L37.9 477.7L29.9 474.5C20.4 470.7 16.1 467.9 6.8 459.6L0 453.5L0.4 472.6C0.9 490.3 1 492.3 3.5 501.3C12.2 533.1 33.2 555.8 60.9 563.2C67.8 565.1 70.5 565.2 99.4 565.6L130.3 566V655.6C130.3 709.7 130 749.6 129.5 756.4C129 762.6 127.4 774.2 126 782.3C119.5 819.6 107.8 847.7 91 865.9L87.6 869.6H256.7C357.8 869.6 433.4 869.2 444.5 868.7C464 867.7 507.5 863.4 517.3 861.3C520.4 860.7 526.2 859.8 530 859.2C538.1 858 551.5 855.2 570.8 850.3C598 843.5 622.8 835 647.1 824.2C654.7 820.8 676.5 809.7 682.3 806.2C685.4 804.4 689.1 802.2 690.5 801.5C694.4 799.4 700.9 795.2 710.4 788.4C715.1 785 719.8 781.7 720.8 781C725 778.2 739.5 766.1 746.1 760C771.2 736.9 792.2 711.2 808.5 683.7C810.8 679.7 813.8 674.7 815.1 672.6C818.4 667 832 639 833.3 634.8C833.9 632.9 834.7 630.9 835.1 630.5C837.7 627.1 852.7 579.9 854.5 569.6C855.1 566.3 855.4 565.8 857.9 565.3C859.5 565 882.8 565 909.7 565.2C963.5 565.6 963.5 565.6 975.4 571.1C982.1 574.2 984.1 575.6 991.5 582.3C1001.2 591 1000.3 592.4 999.7 570.6C999.3 557.8 998.8 549.9 997.9 546.7C994.5 534.4 993.7 531.8 990.7 525.6C980.9 504.2 964.5 488.9 943.5 481.6L935.3 478.6L901.9 478.2L868.6 477.7L869 466C869.4 450.6 869.4 420.1 868.9 404.4L868.5 391.8L913.1 391.6C951.3 391.4 958.4 391.6 962.6 392.7C975.2 396.2 983.7 401 994.1 410.5L999.9 415.9V401.1C999.9 383.5 999 375.7 995.4 364.1C988.3 340.6 974.3 323.1 954.3 312.3C941.3 305.3 940.5 305.1 895.8 304.8C869.6 304.6 855.9 304.2 855.2 303.6C854.6 303 854.1 302 854.1 301.2C854.1 300.4 852.6 294.1 850.6 287.3C827.2 204.6 783.5 138.9 719.6 90.2C710.9 83.5 689.6 69.4 681 64.6C677.7 62.7 674.1 60.7 673.2 60.1C669 57.8 644.9 46 638.9 43.5C635.3 41.9 630.6 39.9 628.5 39.1C593.2 23.8 534 9.3 488.8 4.8C481.4 4.1 471.6 3 467.1 2.6C446.7 0.3 418.4 0 257.7 0C121.9 0 87.8 0.3 88.3 1ZM419 44.3C452.8 46.3 473.6 48.9 497.9 54.8C572.1 72.4 624.3 109.6 662.2 171.8C665.7 177.6 680.5 207.8 682.7 213.9C693.2 242.2 698.3 259 702.8 281.2C703.9 286.6 705.4 293.8 706.1 297.2C706.8 300.5 707.1 303.6 706.8 303.9C706.3 304.3 605.9 304.5 483.5 304.4L261 304.2L260.7 175.7C260.6 105.1 260.7 46.4 261 45.3L261.4 43.4H332.5C371.5 43.4 410.5 43.8 419 44.3ZM716.5 394.6C717.2 398.9 717.2 471.9 716.5 475.5L715.9 478.2L488.4 478L261 477.7L260.8 435.3C260.6 412 260.8 392.6 261 392.2C261.3 391.7 358.2 391.4 488.7 391.4H715.9L716.5 394.6ZM706.3 566.3C706.8 567.8 704.4 580.1 699.5 600.1C693.9 622.6 686.3 645.3 678.6 662.1C674.8 670.7 665.3 689.3 663 692.8C661.9 694.4 658.7 699.5 655.9 704C637.9 732.2 612.2 757.9 582.9 776.9C572.2 783.7 550.2 795.3 544.3 797.1C543.1 797.4 541.8 798 541.3 798.4C540.6 799 531.5 802.4 520.9 806.2C501.4 813.1 464.3 820.6 434.5 823.7C415.2 825.6 412.1 825.7 337.8 825.7H260.9V696V566.2L481.8 565.8C603.3 565.6 703.4 565.3 704.2 565.1C705.1 565 706 565.6 706.3 566.3Z"
                                                    fill="{{ $color ?? 'black' }}" />
                                            </svg>
                                        </span>
                                    </div>
                                </td>
                                <td class="py-3 px-4 text-black text-left">Base Amount</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 text-black flex items-center">رسوم بوابة الدفع (7.9% + 2 <svg
                                        width="{{ $width ?? 14 }}" height="{{ $height ?? 14 }}"
                                        xmlns="http://www.w3.org/2000/svg" width="1000" height="870"
                                        viewBox="0 0 1000 870" fill="none">
                                        <path
                                            d="M88.3 1C88.7 1.6 90.9 4.3 93 6.9C108.3 25.1 119.8 54.7 126 92C130.1 116.5 130.3 124.2 130.3 217.6V304.6H88.5C50.3 304.6 45.9 304.4 38.4 302.9C26.6 300.4 14.4 293.7 6.2 285.1C-0.3 278.2 -0.1 277.8 0.3 298.7C0.8 316 1 317.9 3.5 327.3C7.5 342.2 13 353.3 21.3 363.2C32.6 376.8 44.1 384.4 60.5 389.5C64 390.5 71.4 390.9 97.6 391.1L130.3 391.6V434.9V478.3L84.2 478L37.9 477.7L29.9 474.5C20.4 470.7 16.1 467.9 6.8 459.6L0 453.5L0.4 472.6C0.9 490.3 1 492.3 3.5 501.3C12.2 533.1 33.2 555.8 60.9 563.2C67.8 565.1 70.5 565.2 99.4 565.6L130.3 566V655.6C130.3 709.7 130 749.6 129.5 756.4C129 762.6 127.4 774.2 126 782.3C119.5 819.6 107.8 847.7 91 865.9L87.6 869.6H256.7C357.8 869.6 433.4 869.2 444.5 868.7C464 867.7 507.5 863.4 517.3 861.3C520.4 860.7 526.2 859.8 530 859.2C538.1 858 551.5 855.2 570.8 850.3C598 843.5 622.8 835 647.1 824.2C654.7 820.8 676.5 809.7 682.3 806.2C685.4 804.4 689.1 802.2 690.5 801.5C694.4 799.4 700.9 795.2 710.4 788.4C715.1 785 719.8 781.7 720.8 781C725 778.2 739.5 766.1 746.1 760C771.2 736.9 792.2 711.2 808.5 683.7C810.8 679.7 813.8 674.7 815.1 672.6C818.4 667 832 639 833.3 634.8C833.9 632.9 834.7 630.9 835.1 630.5C837.7 627.1 852.7 579.9 854.5 569.6C855.1 566.3 855.4 565.8 857.9 565.3C859.5 565 882.8 565 909.7 565.2C963.5 565.6 963.5 565.6 975.4 571.1C982.1 574.2 984.1 575.6 991.5 582.3C1001.2 591 1000.3 592.4 999.7 570.6C999.3 557.8 998.8 549.9 997.9 546.7C994.5 534.4 993.7 531.8 990.7 525.6C980.9 504.2 964.5 488.9 943.5 481.6L935.3 478.6L901.9 478.2L868.6 477.7L869 466C869.4 450.6 869.4 420.1 868.9 404.4L868.5 391.8L913.1 391.6C951.3 391.4 958.4 391.6 962.6 392.7C975.2 396.2 983.7 401 994.1 410.5L999.9 415.9V401.1C999.9 383.5 999 375.7 995.4 364.1C988.3 340.6 974.3 323.1 954.3 312.3C941.3 305.3 940.5 305.1 895.8 304.8C869.6 304.6 855.9 304.2 855.2 303.6C854.6 303 854.1 302 854.1 301.2C854.1 300.4 852.6 294.1 850.6 287.3C827.2 204.6 783.5 138.9 719.6 90.2C710.9 83.5 689.6 69.4 681 64.6C677.7 62.7 674.1 60.7 673.2 60.1C669 57.8 644.9 46 638.9 43.5C635.3 41.9 630.6 39.9 628.5 39.1C593.2 23.8 534 9.3 488.8 4.8C481.4 4.1 471.6 3 467.1 2.6C446.7 0.3 418.4 0 257.7 0C121.9 0 87.8 0.3 88.3 1ZM419 44.3C452.8 46.3 473.6 48.9 497.9 54.8C572.1 72.4 624.3 109.6 662.2 171.8C665.7 177.6 680.5 207.8 682.7 213.9C693.2 242.2 698.3 259 702.8 281.2C703.9 286.6 705.4 293.8 706.1 297.2C706.8 300.5 707.1 303.6 706.8 303.9C706.3 304.3 605.9 304.5 483.5 304.4L261 304.2L260.7 175.7C260.6 105.1 260.7 46.4 261 45.3L261.4 43.4H332.5C371.5 43.4 410.5 43.8 419 44.3ZM716.5 394.6C717.2 398.9 717.2 471.9 716.5 475.5L715.9 478.2L488.4 478L261 477.7L260.8 435.3C260.6 412 260.8 392.6 261 392.2C261.3 391.7 358.2 391.4 488.7 391.4H715.9L716.5 394.6ZM706.3 566.3C706.8 567.8 704.4 580.1 699.5 600.1C693.9 622.6 686.3 645.3 678.6 662.1C674.8 670.7 665.3 689.3 663 692.8C661.9 694.4 658.7 699.5 655.9 704C637.9 732.2 612.2 757.9 582.9 776.9C572.2 783.7 550.2 795.3 544.3 797.1C543.1 797.4 541.8 798 541.3 798.4C540.6 799 531.5 802.4 520.9 806.2C501.4 813.1 464.3 820.6 434.5 823.7C415.2 825.6 412.1 825.7 337.8 825.7H260.9V696V566.2L481.8 565.8C603.3 565.6 703.4 565.3 704.2 565.1C705.1 565 706 565.6 706.3 566.3Z"
                                            fill="{{ $color ?? 'black' }}" />
                                    </svg>)</td>
                                <td class="text-center py-3 px-4 text-black font-bold">
                                    <div class="flex items-center gap-1 justify-center">
                                       <span dir="ltr">{{ $installment ? number_format($installment->fees, 2) : number_format($payment->fees, 2) }}</span>
                                        <span class="text-xs"><svg width="{{ $width ?? 14 }}"
                                                height="{{ $height ?? 14 }}" xmlns="http://www.w3.org/2000/svg"
                                                width="1000" height="870" viewBox="0 0 1000 870" fill="none">
                                                <path
                                                    d="M88.3 1C88.7 1.6 90.9 4.3 93 6.9C108.3 25.1 119.8 54.7 126 92C130.1 116.5 130.3 124.2 130.3 217.6V304.6H88.5C50.3 304.6 45.9 304.4 38.4 302.9C26.6 300.4 14.4 293.7 6.2 285.1C-0.3 278.2 -0.1 277.8 0.3 298.7C0.8 316 1 317.9 3.5 327.3C7.5 342.2 13 353.3 21.3 363.2C32.6 376.8 44.1 384.4 60.5 389.5C64 390.5 71.4 390.9 97.6 391.1L130.3 391.6V434.9V478.3L84.2 478L37.9 477.7L29.9 474.5C20.4 470.7 16.1 467.9 6.8 459.6L0 453.5L0.4 472.6C0.9 490.3 1 492.3 3.5 501.3C12.2 533.1 33.2 555.8 60.9 563.2C67.8 565.1 70.5 565.2 99.4 565.6L130.3 566V655.6C130.3 709.7 130 749.6 129.5 756.4C129 762.6 127.4 774.2 126 782.3C119.5 819.6 107.8 847.7 91 865.9L87.6 869.6H256.7C357.8 869.6 433.4 869.2 444.5 868.7C464 867.7 507.5 863.4 517.3 861.3C520.4 860.7 526.2 859.8 530 859.2C538.1 858 551.5 855.2 570.8 850.3C598 843.5 622.8 835 647.1 824.2C654.7 820.8 676.5 809.7 682.3 806.2C685.4 804.4 689.1 802.2 690.5 801.5C694.4 799.4 700.9 795.2 710.4 788.4C715.1 785 719.8 781.7 720.8 781C725 778.2 739.5 766.1 746.1 760C771.2 736.9 792.2 711.2 808.5 683.7C810.8 679.7 813.8 674.7 815.1 672.6C818.4 667 832 639 833.3 634.8C833.9 632.9 834.7 630.9 835.1 630.5C837.7 627.1 852.7 579.9 854.5 569.6C855.1 566.3 855.4 565.8 857.9 565.3C859.5 565 882.8 565 909.7 565.2C963.5 565.6 963.5 565.6 975.4 571.1C982.1 574.2 984.1 575.6 991.5 582.3C1001.2 591 1000.3 592.4 999.7 570.6C999.3 557.8 998.8 549.9 997.9 546.7C994.5 534.4 993.7 531.8 990.7 525.6C980.9 504.2 964.5 488.9 943.5 481.6L935.3 478.6L901.9 478.2L868.6 477.7L869 466C869.4 450.6 869.4 420.1 868.9 404.4L868.5 391.8L913.1 391.6C951.3 391.4 958.4 391.6 962.6 392.7C975.2 396.2 983.7 401 994.1 410.5L999.9 415.9V401.1C999.9 383.5 999 375.7 995.4 364.1C988.3 340.6 974.3 323.1 954.3 312.3C941.3 305.3 940.5 305.1 895.8 304.8C869.6 304.6 855.9 304.2 855.2 303.6C854.6 303 854.1 302 854.1 301.2C854.1 300.4 852.6 294.1 850.6 287.3C827.2 204.6 783.5 138.9 719.6 90.2C710.9 83.5 689.6 69.4 681 64.6C677.7 62.7 674.1 60.7 673.2 60.1C669 57.8 644.9 46 638.9 43.5C635.3 41.9 630.6 39.9 628.5 39.1C593.2 23.8 534 9.3 488.8 4.8C481.4 4.1 471.6 3 467.1 2.6C446.7 0.3 418.4 0 257.7 0C121.9 0 87.8 0.3 88.3 1ZM419 44.3C452.8 46.3 473.6 48.9 497.9 54.8C572.1 72.4 624.3 109.6 662.2 171.8C665.7 177.6 680.5 207.8 682.7 213.9C693.2 242.2 698.3 259 702.8 281.2C703.9 286.6 705.4 293.8 706.1 297.2C706.8 300.5 707.1 303.6 706.8 303.9C706.3 304.3 605.9 304.5 483.5 304.4L261 304.2L260.7 175.7C260.6 105.1 260.7 46.4 261 45.3L261.4 43.4H332.5C371.5 43.4 410.5 43.8 419 44.3ZM716.5 394.6C717.2 398.9 717.2 471.9 716.5 475.5L715.9 478.2L488.4 478L261 477.7L260.8 435.3C260.6 412 260.8 392.6 261 392.2C261.3 391.7 358.2 391.4 488.7 391.4H715.9L716.5 394.6ZM706.3 566.3C706.8 567.8 704.4 580.1 699.5 600.1C693.9 622.6 686.3 645.3 678.6 662.1C674.8 670.7 665.3 689.3 663 692.8C661.9 694.4 658.7 699.5 655.9 704C637.9 732.2 612.2 757.9 582.9 776.9C572.2 783.7 550.2 795.3 544.3 797.1C543.1 797.4 541.8 798 541.3 798.4C540.6 799 531.5 802.4 520.9 806.2C501.4 813.1 464.3 820.6 434.5 823.7C415.2 825.6 412.1 825.7 337.8 825.7H260.9V696V566.2L481.8 565.8C603.3 565.6 703.4 565.3 704.2 565.1C705.1 565 706 565.6 706.3 566.3Z"
                                                    fill="{{ $color ?? 'black' }}" />
                                            </svg></span>
                                    </div>
                                </td>
                                <td class="py-3 px-4 text-black text-left">Payment Gateway Fees</td>
                            </tr>
                            <tr class="bg-gray-50 border-t-2 border-black">
                                <td class="py-4 px-4 font-bold text-black">الإجمالي المدفوع</td>
                                <td class="text-center py-4 px-4 text-black font-bold text-xl">
                                    <div
                                        class="flex items-center gap-1 justify-center border-b-2 border-black inline-block">
                                        <span dir="ltr">{{ number_format($totalWithFees, 2) }}</span>
                                        <span class="text-sm"><svg width="{{ $width ?? 14 }}"
                                                height="{{ $height ?? 14 }}" xmlns="http://www.w3.org/2000/svg"
                                                width="1000" height="870" viewBox="0 0 1000 870" fill="none">
                                                <path
                                                    d="M88.3 1C88.7 1.6 90.9 4.3 93 6.9C108.3 25.1 119.8 54.7 126 92C130.1 116.5 130.3 124.2 130.3 217.6V304.6H88.5C50.3 304.6 45.9 304.4 38.4 302.9C26.6 300.4 14.4 293.7 6.2 285.1C-0.3 278.2 -0.1 277.8 0.3 298.7C0.8 316 1 317.9 3.5 327.3C7.5 342.2 13 353.3 21.3 363.2C32.6 376.8 44.1 384.4 60.5 389.5C64 390.5 71.4 390.9 97.6 391.1L130.3 391.6V434.9V478.3L84.2 478L37.9 477.7L29.9 474.5C20.4 470.7 16.1 467.9 6.8 459.6L0 453.5L0.4 472.6C0.9 490.3 1 492.3 3.5 501.3C12.2 533.1 33.2 555.8 60.9 563.2C67.8 565.1 70.5 565.2 99.4 565.6L130.3 566V655.6C130.3 709.7 130 749.6 129.5 756.4C129 762.6 127.4 774.2 126 782.3C119.5 819.6 107.8 847.7 91 865.9L87.6 869.6H256.7C357.8 869.6 433.4 869.2 444.5 868.7C464 867.7 507.5 863.4 517.3 861.3C520.4 860.7 526.2 859.8 530 859.2C538.1 858 551.5 855.2 570.8 850.3C598 843.5 622.8 835 647.1 824.2C654.7 820.8 676.5 809.7 682.3 806.2C685.4 804.4 689.1 802.2 690.5 801.5C694.4 799.4 700.9 795.2 710.4 788.4C715.1 785 719.8 781.7 720.8 781C725 778.2 739.5 766.1 746.1 760C771.2 736.9 792.2 711.2 808.5 683.7C810.8 679.7 813.8 674.7 815.1 672.6C818.4 667 832 639 833.3 634.8C833.9 632.9 834.7 630.9 835.1 630.5C837.7 627.1 852.7 579.9 854.5 569.6C855.1 566.3 855.4 565.8 857.9 565.3C859.5 565 882.8 565 909.7 565.2C963.5 565.6 963.5 565.6 975.4 571.1C982.1 574.2 984.1 575.6 991.5 582.3C1001.2 591 1000.3 592.4 999.7 570.6C999.3 557.8 998.8 549.9 997.9 546.7C994.5 534.4 993.7 531.8 990.7 525.6C980.9 504.2 964.5 488.9 943.5 481.6L935.3 478.6L901.9 478.2L868.6 477.7L869 466C869.4 450.6 869.4 420.1 868.9 404.4L868.5 391.8L913.1 391.6C951.3 391.4 958.4 391.6 962.6 392.7C975.2 396.2 983.7 401 994.1 410.5L999.9 415.9V401.1C999.9 383.5 999 375.7 995.4 364.1C988.3 340.6 974.3 323.1 954.3 312.3C941.3 305.3 940.5 305.1 895.8 304.8C869.6 304.6 855.9 304.2 855.2 303.6C854.6 303 854.1 302 854.1 301.2C854.1 300.4 852.6 294.1 850.6 287.3C827.2 204.6 783.5 138.9 719.6 90.2C710.9 83.5 689.6 69.4 681 64.6C677.7 62.7 674.1 60.7 673.2 60.1C669 57.8 644.9 46 638.9 43.5C635.3 41.9 630.6 39.9 628.5 39.1C593.2 23.8 534 9.3 488.8 4.8C481.4 4.1 471.6 3 467.1 2.6C446.7 0.3 418.4 0 257.7 0C121.9 0 87.8 0.3 88.3 1ZM419 44.3C452.8 46.3 473.6 48.9 497.9 54.8C572.1 72.4 624.3 109.6 662.2 171.8C665.7 177.6 680.5 207.8 682.7 213.9C693.2 242.2 698.3 259 702.8 281.2C703.9 286.6 705.4 293.8 706.1 297.2C706.8 300.5 707.1 303.6 706.8 303.9C706.3 304.3 605.9 304.5 483.5 304.4L261 304.2L260.7 175.7C260.6 105.1 260.7 46.4 261 45.3L261.4 43.4H332.5C371.5 43.4 410.5 43.8 419 44.3ZM716.5 394.6C717.2 398.9 717.2 471.9 716.5 475.5L715.9 478.2L488.4 478L261 477.7L260.8 435.3C260.6 412 260.8 392.6 261 392.2C261.3 391.7 358.2 391.4 488.7 391.4H715.9L716.5 394.6ZM706.3 566.3C706.8 567.8 704.4 580.1 699.5 600.1C693.9 622.6 686.3 645.3 678.6 662.1C674.8 670.7 665.3 689.3 663 692.8C661.9 694.4 658.7 699.5 655.9 704C637.9 732.2 612.2 757.9 582.9 776.9C572.2 783.7 550.2 795.3 544.3 797.1C543.1 797.4 541.8 798 541.3 798.4C540.6 799 531.5 802.4 520.9 806.2C501.4 813.1 464.3 820.6 434.5 823.7C415.2 825.6 412.1 825.7 337.8 825.7H260.9V696V566.2L481.8 565.8C603.3 565.6 703.4 565.3 704.2 565.1C705.1 565 706 565.6 706.3 566.3Z"
                                                    fill="{{ $color ?? 'black' }}" />
                                            </svg></span>
                                    </div>
                                </td>
                                <td class="py-4 px-4 text-black font-bold text-left">Total Paid</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                @if($installment)
                <div class="mt-6 p-4 bg-white border-2 border-black rounded-lg">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-info-circle text-black mt-0.5 text-lg"></i>
                        <div class="flex-1">
                            <p class="text-sm text-black font-bold mb-2 underline">معلومات القسط / Installment Info:</p>
                            <div class="grid md:grid-cols-2 gap-x-4 gap-y-1 text-sm text-black">
                                <div>• اسم الدفعة: <strong>{{ $installment->payment_name }}</strong></div>
                                <div class="flex items-center">• مبلغ القسط: <strong class="flex items-center gap-2">{{
                                        number_format($installment->amount, 2) }} <svg width="{{ $width ?? 14 }}"
                                            height="{{ $height ?? 14 }}" xmlns="http://www.w3.org/2000/svg" width="1000"
                                            height="870" viewBox="0 0 1000 870" fill="none">
                                            <path
                                                d="M88.3 1C88.7 1.6 90.9 4.3 93 6.9C108.3 25.1 119.8 54.7 126 92C130.1 116.5 130.3 124.2 130.3 217.6V304.6H88.5C50.3 304.6 45.9 304.4 38.4 302.9C26.6 300.4 14.4 293.7 6.2 285.1C-0.3 278.2 -0.1 277.8 0.3 298.7C0.8 316 1 317.9 3.5 327.3C7.5 342.2 13 353.3 21.3 363.2C32.6 376.8 44.1 384.4 60.5 389.5C64 390.5 71.4 390.9 97.6 391.1L130.3 391.6V434.9V478.3L84.2 478L37.9 477.7L29.9 474.5C20.4 470.7 16.1 467.9 6.8 459.6L0 453.5L0.4 472.6C0.9 490.3 1 492.3 3.5 501.3C12.2 533.1 33.2 555.8 60.9 563.2C67.8 565.1 70.5 565.2 99.4 565.6L130.3 566V655.6C130.3 709.7 130 749.6 129.5 756.4C129 762.6 127.4 774.2 126 782.3C119.5 819.6 107.8 847.7 91 865.9L87.6 869.6H256.7C357.8 869.6 433.4 869.2 444.5 868.7C464 867.7 507.5 863.4 517.3 861.3C520.4 860.7 526.2 859.8 530 859.2C538.1 858 551.5 855.2 570.8 850.3C598 843.5 622.8 835 647.1 824.2C654.7 820.8 676.5 809.7 682.3 806.2C685.4 804.4 689.1 802.2 690.5 801.5C694.4 799.4 700.9 795.2 710.4 788.4C715.1 785 719.8 781.7 720.8 781C725 778.2 739.5 766.1 746.1 760C771.2 736.9 792.2 711.2 808.5 683.7C810.8 679.7 813.8 674.7 815.1 672.6C818.4 667 832 639 833.3 634.8C833.9 632.9 834.7 630.9 835.1 630.5C837.7 627.1 852.7 579.9 854.5 569.6C855.1 566.3 855.4 565.8 857.9 565.3C859.5 565 882.8 565 909.7 565.2C963.5 565.6 963.5 565.6 975.4 571.1C982.1 574.2 984.1 575.6 991.5 582.3C1001.2 591 1000.3 592.4 999.7 570.6C999.3 557.8 998.8 549.9 997.9 546.7C994.5 534.4 993.7 531.8 990.7 525.6C980.9 504.2 964.5 488.9 943.5 481.6L935.3 478.6L901.9 478.2L868.6 477.7L869 466C869.4 450.6 869.4 420.1 868.9 404.4L868.5 391.8L913.1 391.6C951.3 391.4 958.4 391.6 962.6 392.7C975.2 396.2 983.7 401 994.1 410.5L999.9 415.9V401.1C999.9 383.5 999 375.7 995.4 364.1C988.3 340.6 974.3 323.1 954.3 312.3C941.3 305.3 940.5 305.1 895.8 304.8C869.6 304.6 855.9 304.2 855.2 303.6C854.6 303 854.1 302 854.1 301.2C854.1 300.4 852.6 294.1 850.6 287.3C827.2 204.6 783.5 138.9 719.6 90.2C710.9 83.5 689.6 69.4 681 64.6C677.7 62.7 674.1 60.7 673.2 60.1C669 57.8 644.9 46 638.9 43.5C635.3 41.9 630.6 39.9 628.5 39.1C593.2 23.8 534 9.3 488.8 4.8C481.4 4.1 471.6 3 467.1 2.6C446.7 0.3 418.4 0 257.7 0C121.9 0 87.8 0.3 88.3 1ZM419 44.3C452.8 46.3 473.6 48.9 497.9 54.8C572.1 72.4 624.3 109.6 662.2 171.8C665.7 177.6 680.5 207.8 682.7 213.9C693.2 242.2 698.3 259 702.8 281.2C703.9 286.6 705.4 293.8 706.1 297.2C706.8 300.5 707.1 303.6 706.8 303.9C706.3 304.3 605.9 304.5 483.5 304.4L261 304.2L260.7 175.7C260.6 105.1 260.7 46.4 261 45.3L261.4 43.4H332.5C371.5 43.4 410.5 43.8 419 44.3ZM716.5 394.6C717.2 398.9 717.2 471.9 716.5 475.5L715.9 478.2L488.4 478L261 477.7L260.8 435.3C260.6 412 260.8 392.6 261 392.2C261.3 391.7 358.2 391.4 488.7 391.4H715.9L716.5 394.6ZM706.3 566.3C706.8 567.8 704.4 580.1 699.5 600.1C693.9 622.6 686.3 645.3 678.6 662.1C674.8 670.7 665.3 689.3 663 692.8C661.9 694.4 658.7 699.5 655.9 704C637.9 732.2 612.2 757.9 582.9 776.9C572.2 783.7 550.2 795.3 544.3 797.1C543.1 797.4 541.8 798 541.3 798.4C540.6 799 531.5 802.4 520.9 806.2C501.4 813.1 464.3 820.6 434.5 823.7C415.2 825.6 412.1 825.7 337.8 825.7H260.9V696V566.2L481.8 565.8C603.3 565.6 703.4 565.3 704.2 565.1C705.1 565 706 565.6 706.3 566.3Z"
                                                fill="{{ $color ?? 'black' }}" />
                                        </svg></strong>
                                </div>
                                <div class="flex items-center">• إجمالي المشروع: <strong
                                        class="flex items-center gap-2">{{ number_format($specialRequest->price, 2) }}
                                        <svg width="{{ $width ?? 14 }}" height="{{ $height ?? 14 }}"
                                            xmlns="http://www.w3.org/2000/svg" width="1000" height="870"
                                            viewBox="0 0 1000 870" fill="none">
                                            <path
                                                d="M88.3 1C88.7 1.6 90.9 4.3 93 6.9C108.3 25.1 119.8 54.7 126 92C130.1 116.5 130.3 124.2 130.3 217.6V304.6H88.5C50.3 304.6 45.9 304.4 38.4 302.9C26.6 300.4 14.4 293.7 6.2 285.1C-0.3 278.2 -0.1 277.8 0.3 298.7C0.8 316 1 317.9 3.5 327.3C7.5 342.2 13 353.3 21.3 363.2C32.6 376.8 44.1 384.4 60.5 389.5C64 390.5 71.4 390.9 97.6 391.1L130.3 391.6V434.9V478.3L84.2 478L37.9 477.7L29.9 474.5C20.4 470.7 16.1 467.9 6.8 459.6L0 453.5L0.4 472.6C0.9 490.3 1 492.3 3.5 501.3C12.2 533.1 33.2 555.8 60.9 563.2C67.8 565.1 70.5 565.2 99.4 565.6L130.3 566V655.6C130.3 709.7 130 749.6 129.5 756.4C129 762.6 127.4 774.2 126 782.3C119.5 819.6 107.8 847.7 91 865.9L87.6 869.6H256.7C357.8 869.6 433.4 869.2 444.5 868.7C464 867.7 507.5 863.4 517.3 861.3C520.4 860.7 526.2 859.8 530 859.2C538.1 858 551.5 855.2 570.8 850.3C598 843.5 622.8 835 647.1 824.2C654.7 820.8 676.5 809.7 682.3 806.2C685.4 804.4 689.1 802.2 690.5 801.5C694.4 799.4 700.9 795.2 710.4 788.4C715.1 785 719.8 781.7 720.8 781C725 778.2 739.5 766.1 746.1 760C771.2 736.9 792.2 711.2 808.5 683.7C810.8 679.7 813.8 674.7 815.1 672.6C818.4 667 832 639 833.3 634.8C833.9 632.9 834.7 630.9 835.1 630.5C837.7 627.1 852.7 579.9 854.5 569.6C855.1 566.3 855.4 565.8 857.9 565.3C859.5 565 882.8 565 909.7 565.2C963.5 565.6 963.5 565.6 975.4 571.1C982.1 574.2 984.1 575.6 991.5 582.3C1001.2 591 1000.3 592.4 999.7 570.6C999.3 557.8 998.8 549.9 997.9 546.7C994.5 534.4 993.7 531.8 990.7 525.6C980.9 504.2 964.5 488.9 943.5 481.6L935.3 478.6L901.9 478.2L868.6 477.7L869 466C869.4 450.6 869.4 420.1 868.9 404.4L868.5 391.8L913.1 391.6C951.3 391.4 958.4 391.6 962.6 392.7C975.2 396.2 983.7 401 994.1 410.5L999.9 415.9V401.1C999.9 383.5 999 375.7 995.4 364.1C988.3 340.6 974.3 323.1 954.3 312.3C941.3 305.3 940.5 305.1 895.8 304.8C869.6 304.6 855.9 304.2 855.2 303.6C854.6 303 854.1 302 854.1 301.2C854.1 300.4 852.6 294.1 850.6 287.3C827.2 204.6 783.5 138.9 719.6 90.2C710.9 83.5 689.6 69.4 681 64.6C677.7 62.7 674.1 60.7 673.2 60.1C669 57.8 644.9 46 638.9 43.5C635.3 41.9 630.6 39.9 628.5 39.1C593.2 23.8 534 9.3 488.8 4.8C481.4 4.1 471.6 3 467.1 2.6C446.7 0.3 418.4 0 257.7 0C121.9 0 87.8 0.3 88.3 1ZM419 44.3C452.8 46.3 473.6 48.9 497.9 54.8C572.1 72.4 624.3 109.6 662.2 171.8C665.7 177.6 680.5 207.8 682.7 213.9C693.2 242.2 698.3 259 702.8 281.2C703.9 286.6 705.4 293.8 706.1 297.2C706.8 300.5 707.1 303.6 706.8 303.9C706.3 304.3 605.9 304.5 483.5 304.4L261 304.2L260.7 175.7C260.6 105.1 260.7 46.4 261 45.3L261.4 43.4H332.5C371.5 43.4 410.5 43.8 419 44.3ZM716.5 394.6C717.2 398.9 717.2 471.9 716.5 475.5L715.9 478.2L488.4 478L261 477.7L260.8 435.3C260.6 412 260.8 392.6 261 392.2C261.3 391.7 358.2 391.4 488.7 391.4H715.9L716.5 394.6ZM706.3 566.3C706.8 567.8 704.4 580.1 699.5 600.1C693.9 622.6 686.3 645.3 678.6 662.1C674.8 670.7 665.3 689.3 663 692.8C661.9 694.4 658.7 699.5 655.9 704C637.9 732.2 612.2 757.9 582.9 776.9C572.2 783.7 550.2 795.3 544.3 797.1C543.1 797.4 541.8 798 541.3 798.4C540.6 799 531.5 802.4 520.9 806.2C501.4 813.1 464.3 820.6 434.5 823.7C415.2 825.6 412.1 825.7 337.8 825.7H260.9V696V566.2L481.8 565.8C603.3 565.6 703.4 565.3 704.2 565.1C705.1 565 706 565.6 706.3 566.3Z"
                                                fill="{{ $color ?? 'black' }}" />
                                        </svg></strong></div>
                                <div class="flex items-center">• المتبقي: <strong class="flex items-center gap-2">{{
                                        number_format($specialRequest->remaining_amount, 2) }}
                                        <svg width="{{ $width ?? 14 }}" height="{{ $height ?? 14 }}"
                                            xmlns="http://www.w3.org/2000/svg" width="1000" height="870"
                                            viewBox="0 0 1000 870" fill="none">
                                            <path
                                                d="M88.3 1C88.7 1.6 90.9 4.3 93 6.9C108.3 25.1 119.8 54.7 126 92C130.1 116.5 130.3 124.2 130.3 217.6V304.6H88.5C50.3 304.6 45.9 304.4 38.4 302.9C26.6 300.4 14.4 293.7 6.2 285.1C-0.3 278.2 -0.1 277.8 0.3 298.7C0.8 316 1 317.9 3.5 327.3C7.5 342.2 13 353.3 21.3 363.2C32.6 376.8 44.1 384.4 60.5 389.5C64 390.5 71.4 390.9 97.6 391.1L130.3 391.6V434.9V478.3L84.2 478L37.9 477.7L29.9 474.5C20.4 470.7 16.1 467.9 6.8 459.6L0 453.5L0.4 472.6C0.9 490.3 1 492.3 3.5 501.3C12.2 533.1 33.2 555.8 60.9 563.2C67.8 565.1 70.5 565.2 99.4 565.6L130.3 566V655.6C130.3 709.7 130 749.6 129.5 756.4C129 762.6 127.4 774.2 126 782.3C119.5 819.6 107.8 847.7 91 865.9L87.6 869.6H256.7C357.8 869.6 433.4 869.2 444.5 868.7C464 867.7 507.5 863.4 517.3 861.3C520.4 860.7 526.2 859.8 530 859.2C538.1 858 551.5 855.2 570.8 850.3C598 843.5 622.8 835 647.1 824.2C654.7 820.8 676.5 809.7 682.3 806.2C685.4 804.4 689.1 802.2 690.5 801.5C694.4 799.4 700.9 795.2 710.4 788.4C715.1 785 719.8 781.7 720.8 781C725 778.2 739.5 766.1 746.1 760C771.2 736.9 792.2 711.2 808.5 683.7C810.8 679.7 813.8 674.7 815.1 672.6C818.4 667 832 639 833.3 634.8C833.9 632.9 834.7 630.9 835.1 630.5C837.7 627.1 852.7 579.9 854.5 569.6C855.1 566.3 855.4 565.8 857.9 565.3C859.5 565 882.8 565 909.7 565.2C963.5 565.6 963.5 565.6 975.4 571.1C982.1 574.2 984.1 575.6 991.5 582.3C1001.2 591 1000.3 592.4 999.7 570.6C999.3 557.8 998.8 549.9 997.9 546.7C994.5 534.4 993.7 531.8 990.7 525.6C980.9 504.2 964.5 488.9 943.5 481.6L935.3 478.6L901.9 478.2L868.6 477.7L869 466C869.4 450.6 869.4 420.1 868.9 404.4L868.5 391.8L913.1 391.6C951.3 391.4 958.4 391.6 962.6 392.7C975.2 396.2 983.7 401 994.1 410.5L999.9 415.9V401.1C999.9 383.5 999 375.7 995.4 364.1C988.3 340.6 974.3 323.1 954.3 312.3C941.3 305.3 940.5 305.1 895.8 304.8C869.6 304.6 855.9 304.2 855.2 303.6C854.6 303 854.1 302 854.1 301.2C854.1 300.4 852.6 294.1 850.6 287.3C827.2 204.6 783.5 138.9 719.6 90.2C710.9 83.5 689.6 69.4 681 64.6C677.7 62.7 674.1 60.7 673.2 60.1C669 57.8 644.9 46 638.9 43.5C635.3 41.9 630.6 39.9 628.5 39.1C593.2 23.8 534 9.3 488.8 4.8C481.4 4.1 471.6 3 467.1 2.6C446.7 0.3 418.4 0 257.7 0C121.9 0 87.8 0.3 88.3 1ZM419 44.3C452.8 46.3 473.6 48.9 497.9 54.8C572.1 72.4 624.3 109.6 662.2 171.8C665.7 177.6 680.5 207.8 682.7 213.9C693.2 242.2 698.3 259 702.8 281.2C703.9 286.6 705.4 293.8 706.1 297.2C706.8 300.5 707.1 303.6 706.8 303.9C706.3 304.3 605.9 304.5 483.5 304.4L261 304.2L260.7 175.7C260.6 105.1 260.7 46.4 261 45.3L261.4 43.4H332.5C371.5 43.4 410.5 43.8 419 44.3ZM716.5 394.6C717.2 398.9 717.2 471.9 716.5 475.5L715.9 478.2L488.4 478L261 477.7L260.8 435.3C260.6 412 260.8 392.6 261 392.2C261.3 391.7 358.2 391.4 488.7 391.4H715.9L716.5 394.6ZM706.3 566.3C706.8 567.8 704.4 580.1 699.5 600.1C693.9 622.6 686.3 645.3 678.6 662.1C674.8 670.7 665.3 689.3 663 692.8C661.9 694.4 658.7 699.5 655.9 704C637.9 732.2 612.2 757.9 582.9 776.9C572.2 783.7 550.2 795.3 544.3 797.1C543.1 797.4 541.8 798 541.3 798.4C540.6 799 531.5 802.4 520.9 806.2C501.4 813.1 464.3 820.6 434.5 823.7C415.2 825.6 412.1 825.7 337.8 825.7H260.9V696V566.2L481.8 565.8C603.3 565.6 703.4 565.3 704.2 565.1C705.1 565 706 565.6 706.3 566.3Z"
                                                fill="{{ $color ?? 'black' }}" />
                                        </svg></strong></div>
                                @if($installment->due_date)
                                <div class="md:col-span-2">• تاريخ الاستحقاق: <strong>{{
                                        \Carbon\Carbon::parse($installment->due_date)->format('Y/m/d') }}</strong></div>
                                @endif
                            </div>
                        </div>
                    </div>
                </div>
                @endif
            </div>

            <div class="bg-gray-50 p-8 border-t-2 border-black">
                <div class="grid md:grid-cols-2 gap-8 text-black">
                    <div>
                        <h4 class="font-bold mb-2">ملاحظات</h4>
                        <p class="text-sm leading-relaxed">
                            تم إنشاء وإصدار هذه الفاتورة إلكترونيًا ولا تحتاج لتصديق.<br>
                            شكرًا لثقتك بنا، ونتطلع لتقديم أفضل خدمة لك.
                        </p>
                    </div>
                    <div>
                        <h4 class="text-left font-bold mb-2">Notes</h4>
                        <p class="text-left text-sm leading-relaxed">
                            This invoice was created and issued electronically and does not require authentication.<br>
                            Thank you for your trust. We look forward to providing you with the best service.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* تحويل كل الصور للأبيض والأسود عند الطباعة */
    @media print {
        img {
            filter: grayscale(100%);
        }

        .bg-gray-50 {
            background-color: #f9fafb !important;
        }

        .bg-gray-100 {
            background-color: #f3f4f6 !important;
        }

        body * {
            visibility: hidden;
        }

        .print-container,
        .print-container * {
            visibility: visible;
        }

        .print-container {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            border: 1px solid black !important;
        }

        .no-print {
            display: none !important;
        }

        @page {
            margin: 1cm;
            size: A4;
        }
    }
</style>
@endsection